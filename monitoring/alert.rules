groups:
  - name: ddos_alert_group
    rules:
      # Alert chÃ­nh: PhÃ¡t hiá»‡n HTTP Flood dá»±a vÃ o traffic
      - alert: HTTPFloodDetected
        expr: rate(nginx_http_requests_total[10s]) > 100
        for: 5s
        labels:
          severity: "critical"
        annotations:
          description: "ðŸš¨ HTTP Flood: Traffic vÆ°á»£t 100 req/s"
          summary: "Rate: {{ $value | humanize }} req/s"
      
      # Alert phá»¥: CPU cao (há»— trá»£ xÃ¡c nháº­n attack)
      - alert: HighCPUServer
        expr: (1 - avg by (instance)(rate(node_cpu_seconds_total{mode="idle"}[15s]))) > 0.50
        for: 10s
        labels:
          severity: "warning"
        annotations:
          description: "âš ï¸ CPU server vÆ°á»£t 50%"
          summary: "CPU: {{ $value | humanizePercentage }}"
      
      # Alert káº¿t há»£p: XÃ¡c nháº­n DDoS (traffic + CPU)
      - alert: ConfirmedDDoS
        expr: |
          (rate(nginx_http_requests_total[10s]) > 100) 
          and 
          ((1 - avg by (instance)(rate(node_cpu_seconds_total{mode="idle"}[15s]))) > 0.50)
        for: 10s
        labels:
          severity: "critical"
        annotations:
          description: "ðŸ”¥ XÃC NHáº¬N DDOS: Traffic cao + CPU cao"
      
      # Alert nÃ¢ng cao: PhÃ¡t hiá»‡n traffic tÄƒng Ä‘á»™t biáº¿n
      - alert: TrafficSpike
        expr: |
          rate(nginx_http_requests_total[1m]) > 
          (avg_over_time(rate(nginx_http_requests_total[1m])[5m:1m]) * 2)
        for: 30s
        labels:
          severity: "warning"
        annotations:
          description: "ðŸ“ˆ Traffic tÄƒng gáº¥p Ä‘Ã´i so vá»›i 5 phÃºt trÆ°á»›c"